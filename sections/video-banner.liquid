{% assign block_count = section.blocks.size %}

<style>
  .video-banner-wrapper {
    position: relative;
    height: ({{ block_count }} * 100vh) + 100vh;
  }

  .video-banner {
    position: sticky;
    top: 0;
    height: 100vh;
    z-index: 1;
    width: 100%;
    overflow: hidden;
  }

  .video-banner iframe,
  .video-banner video {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    border: 0;
  }

  .scrolling-text-container {
    z-index: 2;
    position: relative;
    margin-top: -130vh;
    padding-top: 100vh;
  }

  .scrolling-text-container div {
    height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: #fff;
    text-align: center;
    font-size: 24px;
    animation: fadeText 1.5s ease-in-out;
  }

  .text-scroll-item h2 {
    font-size: 2.25rem;
    margin-bottom: 10px;
    max-width: 800px;
  }

  @keyframes fadeText {
    0% { opacity: 0; transform: translateY(20px); }
    50% { opacity: 1; transform: translateY(0); }
    100% { opacity: 0; transform: translateY(-20px); }
  }
{%- if section.settings.background -%}
  .text-scroll-heading{
    background-color: {{ section.settings.background_color }};
    border-radius: {{ section.settings.corner_radius }}px;
    padding: 5px;
  }
{%- endif -%}
</style>

{% liquid
  assign autoplay = section.settings.video_autoplay
  assign loop = section.settings.video_loop
  assign video_url = ''

  if section.settings.video_url contains 'youtube.com' or section.settings.video_url contains 'youtu.be'
    assign youtube_id = section.settings.video_url | split: 'v=' | last | split: '&' | first
    assign video_url = 'https://www.youtube.com/embed/' | append: youtube_id
    if autoplay
      assign video_url = video_url | append: '?autoplay=1&mute=1'
      if loop
        assign video_url = video_url | append: '&loop=1&playlist=' | append: youtube_id
      endif
    endif
  elsif section.settings.video_url contains 'vimeo.com'
    assign vimeo_id = section.settings.video_url | split: '/' | last
    assign video_url = 'https://player.vimeo.com/video/' | append: vimeo_id
    if autoplay
      assign video_url = video_url | append: '?autoplay=1&muted=1'
      if loop
        assign video_url = video_url | append: '&loop=1'
      endif
    endif
  endif
%}

<div class="video-banner-wrapper">

  <div class="video-banner">
    {% if video_url != blank %}
      <!-- YouTube or Vimeo Video -->
      <iframe
        src="{{ video_url }}"
        title="Video player"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen
      ></iframe>

    {% elsif section.settings.video != blank %}
      <!-- Uploaded Video -->
      <video
        {% if autoplay %}
          autoplay
        {% endif %}
        muted
        {% if loop %}
          loop
        {% endif %}
        playsinline
      >
        {% for source in section.settings.video.sources %}
          <source src="{{ source.url }}" type="{{ source.mime_type }}">
        {% endfor %}
        Your browser does not support the video tag.
      </video>

    {% else %}
      <p>No video provided yet.</p>
    {% endif %}
  </div>

  <div class="scrolling-text-container">
        {% content_for 'blocks' %}
  </div>

</div>

{% schema %}
{
  "name": "Video Background Banner",
  "settings": [
    {
      "type": "select",
      "id": "source",
      "label": "t:settings.video_source",
      "options": [
        {
          "value": "uploaded",
          "label": "t:options.video_uploaded"
        },
        {
          "value": "url",
          "label": "t:options.video_external_url"
        }
      ],
      "default": "uploaded"
    },
    {
      "type": "video",
      "id": "video",
      "label": "t:settings.video",
      "visible_if": "{{ section.settings.source == 'uploaded' }}"
    },
    {
      "type": "video_url",
      "id": "video_url",
      "label": "t:settings.video_external_url",
      "info": "t:info.video_external",
      "accept": ["youtube", "vimeo"],
      "visible_if": "{{ section.settings.source == 'url' }}"
    },
    {
      "type": "checkbox",
      "id": "video_autoplay",
      "label": "t:settings.video_autoplay",
      "info": "t:info.video_autoplay",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "video_loop",
      "label": "t:settings.video_loop",
      "default": true
    },
    {
      "type": "image_picker",
      "id": "cover_image",
      "label": "t:settings.cover_image",
      "visible_if": "{{ section.settings.source == 'url' and section.settings.video_autoplay == false }}"
    },
    {
      "type": "text",
      "id": "alt",
      "label": "t:settings.video_alt_text",
      "info": "t:info.video_alt_text",
      "visible_if": "{{ section.settings.source == 'url' }}"
    },
  ],
  "blocks": [
    {
      "type": "text",
    }
  ],
  "presets": [
    {
      "name": "Video Background Banner",
      "category": "Media",
      "blocks": [
        {
          "type": "text",

        },
        {
          "type": "text",
        },
        {
          "type": "text"
        },
        {
          "type": "text"
        }
      ]
    }
  ]
}
{% endschema %}
